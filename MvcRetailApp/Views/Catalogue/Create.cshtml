@model CodeFirstEntities.MainApplication

@{
    ViewBag.Title = "Create";
}

<meta charset="utf-8" />
<title>Retail Managment Software</title>
<meta name="keywords" content="Retail Software" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Font CSS  -->
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700" />
<link href="~/Content/style.default.css" rel="stylesheet" />
<link href="~/Content/style.default.blue.css" rel="stylesheet" />
<!-- Core CSS  -->
<link rel="stylesheet" type="text/css" href="~/Content/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="~/Content/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="~/Content/sb-admin-2.css" />
<link rel="stylesheet" type="text/css" href="~/Content/metisMenu.min.css" />
<link rel="stylesheet" type="text/css" href="~/Content/font-awesome.css" />
<link rel="stylesheet" type="text/css" href="~/fonts/glyphicons.min.css" />

<!-- Plugin CSS -->
<link rel="stylesheet" type="text/css" href="~/Content/fullcalendar.css" />
<link rel="stylesheet" type="text/css" href="~/Content/datatables.min.css" />
@*<link rel="stylesheet" type="text/css" href="~/Content/animate.css" />*@

<!-- Theme CSS -->
<link rel="stylesheet" type="text/css" href="~/Content/theme.css" />
<link rel="stylesheet" type="text/css" href="~/Content/pages.css" />
<link rel="stylesheet" type="text/css" href="~/Content/plugins.css" />
<link rel="stylesheet" type="text/css" href="~/Content/responsive.css" />

<!-- Demonstration CSS -->
<link rel="stylesheet" type="text/css" href="~/Content/demo.css" />

<!-- Your Custom CSS -->
<link rel="stylesheet" type="text/css" href="~/Content/custom.css" />

<!-- Favicon -->
<link rel="shortcut icon" href="~/Images/favicon.ico" />

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script src="@Url.Content("~/Scripts/jquery-1.9.1.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-1.9.1.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.24.min.js")" type="text/javascript"></script>

<!-- Plugins - Via CDN -->
<script type="text/javascript" src="~/Scripts/jquery.flot.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="~/Scripts/fullcalendar.min.js"></script>
<script type="text/javascript" src="~/Scripts/bootstrap.js"></script>


<script type="text/javascript" src="~/Scripts/jquery.scrollTo-1.4.3.1-min.js"></script>

<!-- Theme Javascript -->
<script type="text/javascript" src="~/Scripts/uniform.min.js"></script>
<script type="text/javascript" src="~/Scripts/main.js"></script>
<script type="text/javascript" src="~/Scripts/custom.js"></script>
<script type="text/javascript" src="~/Scripts/sb-admin-2.js"></script>
<script type="text/javascript" src="~/vendor/plugins/metisMenu/metisMenu.min.js"></script>

<script type="text/javascript">
    jQuery(document).ready(function () {
        $(".menu-collapse").click();
        // Init Theme Core 	  
        Core.init();

        $("input").not($(":button")).keypress(function (evt) {
            if (evt.keyCode == 13) {
                iname = $(this).val();
                if (iname !== 'Submit') {
                    var fields = $(this).parents('form:eq(0),body').find('button,input,textarea,select');
                    var index = fields.index(this);
                    if (index > -1 && (index + 1) < fields.length) {
                        fields.eq(index + 1).focus();
                    }
                    return false;
                }
            }
        });
    });

</script>

<link href="~/Content/customAlerts.css" rel="stylesheet" />
<script src="~/Scripts/bootbox.js"></script>

<script type="text/javascript">
    function alertbox(message) {
        var sample = document.getElementById("audio");
        sample.src = '../../Audio/tone1.ogg';

        sample.load();
        sample.muted = false;
        sample.play();

        bootbox.classes('alertClass');
        bootbox.alert('<i class="fa fa-2x fa-warning"></i><br>' + message + '<hr>');
    }

    function confirmbox(message, row) {
        var sample = document.getElementById("audio");
        sample.src = '../../Audio/tone2.ogg';
        sample.load();
        sample.muted = false;
        sample.play();

        bootbox.classes('confirmClass');
        bootbox.confirm('<i class="fa fa-2x fa-question-circle"></i><br>' + message + '<hr>',
		 function (result) {
		     if (result) {
		         $("#" + row).remove();
		     }
		 });
    }
</script>

@*TO DELETE ROW*@
<script type="text/javascript">
    function DeleteRow(id) {
        var row = "row" + id;
        confirmbox("Are you sure you wish to delete this row?", row);

    }
</script>


@*ENABLE DISABLED ROW*@
<script type="text/javascript">
    $(document).ready(function () {
        $("#Save").click(function () {

            var rowId = document.getElementById("hdnRowCount").value;

            var typeOfMaterial = "materialType" + rowId;
            var colorCode = "colorCodeData" + rowId;
            var designCode = "designCodeData" + rowId;
            var description = "itemDescription" + rowId;
            var size = "Size" + rowId;
            var unit = "Unit" + rowId;
            var brand = "Brand" + rowId;
            var costprice = "CostPrice" + rowId;
            var sellingprice = "SellingPrice" + rowId;
            var mrp = "MRP" + rowId;
            var subcategory = "subcategory" + rowId;
            var itemname = "itemname" + rowId;
            var itemtype = "ItemType" + rowId;

            if (document.getElementById(costprice) != null) {
                //If last row is inventory then check all the validations

                var type = document.getElementById("ItemType").value;

                if (type == "Inventory" || type == "Select") {

                    //if ($("#" + subcategory).val() == "") {
                    //    alertbox("Please Enter The Subcategory");
                    //    return false;
                    //}
                    if ($("#" + itemname).val() == "") {
                        alertbox("Please Enter The Item Name");
                        return false;
                    }
                    else if ($("#" + itemtype).val() == "Select") {
                        alertbox("Please Select The Item Type");
                        return false;
                    }
                    else if ($("#" + size).val() == "") {
                        alertbox("Please Enter The Size");
                        return false;
                    }
                        //else if ($("#" + typeOfMaterial).val() == "") {
                        //    alertbox("Please Select The Type Of Material");
                        //    return false;
                        //}
                        //else if ($("#" + designCode).val() == "") {
                        //    alertbox("Please Select The Design Code");
                        //    return false;
                        //}
                    else if ($("#" + brand).val() == "") {
                        alertbox("Please Select The Brand Name");
                        return false;
                    }
                        //else if ($("#" + costprice).val() == "") {
                        //    $("#" + costprice).val(0);
                        //}
                        //else if ($("#" + sellingprice).val() == "") {
                        //    $("#" + sellingprice).val(0);
                        //}
                        //else if ($("#" + mrp).val() == "") {
                        //    $("#" + mrp).val(0);
                        //}

                    else {
                        //CHECK IF SAME ITEM IS ALREADY CREATED THEN GET ALERT 
                        var counter = 0;
                        for (i = 1; i < rowId; i++) {
                            var MATERIAL = "materialType" + i;
                            var COLOR = "colorCodeData" + i;
                            var COSTPRICE = "CostPrice" + i;
                            var BRAND = "Brand" + i;
                            var SIZE = "Size" + i;
                            var DESIGN = "designCodeData" + i;
                            var UNIT = "Unit" + i;

                            //var material = document.getElementById("materialType" + rowId).value;
                            var color = document.getElementById("colorCodeData" + rowId).value;
                            var costprice = document.getElementById("CostPrice" + rowId).value;
                            var brand = document.getElementById("Brand" + rowId).value;
                            var size = document.getElementById("Size" + rowId).value;
                            //var design = document.getElementById("designCodeData" + rowId).value;
                            var unit = document.getElementById("Unit" + rowId).value;

                            //IF ROW IS DELETED THEN CURRENT ITEM WON'T GET COMPARED
                            if ($("#" + MATERIAL).val() == null && $("#" + COLOR).val() == color && $("#" + COSTPRICE).val() == costprice && $("#" + BRAND).val() == brand && $("#" + SIZE).val() == size && $("#" + DESIGN).val() == null && $("#" + UNIT).val() == unit) {
                                alertbox("The Item Is Already Created..");
                                counter = i;
                                return false;
                            }
                        }
                        if (counter == 0) {
                            //var material = document.getElementById("materialType" + rowId).value;
                            var color = document.getElementById("colorCodeData" + rowId).value;
                            var costprice = document.getElementById("CostPrice" + rowId).value;
                            var brand = document.getElementById("Brand" + rowId).value;
                            var size = document.getElementById("Size" + rowId).value;
                            //var design = document.getElementById("designCodeData" + rowId).value;
                            var unit = document.getElementById("Unit" + rowId).value;
                            var SUBCAT = document.getElementById("subcategory").value;

                            //CHECK ITEM IS ALREADY CREATED IN THE DATABASE
                            $.getJSON("/Item/GetAllItemDetails", { Material: null, Color: color, Costprice: costprice, Brand: brand, Size: size, Design: null, Unit: unit, SubCat: SUBCAT },
                           function (stateData) {
                               if (stateData == "Present") {
                                   alertbox("The Item Is Already Created..")
                                   return false;
                               }

                               else {
                                   //DISABLED DYNAMIC ROW
                                   for (var i = 1; i <= rowId; i++) {
                                       var subcategory = "subcategory" + i;
                                       var typeOfMaterial = "materialType" + i;
                                       var colorCode = "colorCodeData" + i;
                                       var designCode = "designCodeData" + i;
                                       var description = "itemDescription" + i;
                                       var size = "Size" + i;
                                       var unit = "Unit" + i;
                                       var costprice = "CostPrice" + i;
                                       var sellingprice = "SellingPrice" + i;
                                       var mrp = "MRP" + i;
                                       var brand = "Brand" + i;
                                       var itemname = "itemname" + i;
                                       var itemtype = "ItemType" + i;
                                       var serialno = "serialno" + i;
                                       var supplier = "supplier" + i;

                                       if (document.getElementById(costprice) != null) {
                                           //document.getElementById("item").disabled = false;
                                           //document.getElementById(typeOfMaterial).disabled = false;
                                           //document.getElementById(subcategory).disabled = false;
                                           document.getElementById(colorCode).disabled = false;
                                           //document.getElementById(designCode).disabled = false;
                                           document.getElementById(description).disabled = false;
                                           document.getElementById(size).disabled = false;
                                           document.getElementById(unit).disabled = false;
                                           document.getElementById(type).disabled = false;
                                           document.getElementById(costprice).disabled = false;
                                           //document.getElementById(sellingprice).disabled = false;
                                           //document.getElementById(mrp).disabled = false;
                                           document.getElementById(brand).disabled = false;
                                           document.getElementById("bookno").disabled = false;
                                           document.getElementById("category").disabled = false;
                                           document.getElementById(itemname).disabled = false;
                                           //document.getElementById(itemtype).disabled = false;
                                           document.getElementById(serialno).disabled = false;
                                           //document.getElementById(supplier).disabled = false;
                                       }
                                   }
                                   $("#Submit").trigger('click');
                               }
                           });
                        }
                    }
                }
                    // IF LAST ITEM IS NON INVENTORY THEN WITHOUT VALIDATION SUBMIT THE DATA..
                else {

                    //if ($("#" + unit).val() == "" || $("#" + type).val() == "") {
                    //    alertbox("Please Select Unit For Non Inventory Type");
                    //    return false;
                    //}

                    if ($("#" + unit).val() == "") {
                        alertbox("Please Select Unit For Non Inventory Type");
                        return false;
                    }


                    //DISABLED DYNAMIC ROW
                    for (var i = 1; i <= rowId; i++) {
                        var typeOfMaterial = "materialType" + i;
                        var colorCode = "colorCodeData" + i;
                        var designCode = "designCodeData" + i;
                        var description = "itemDescription" + i;
                        var size = "Size" + i;
                        var unit = "Unit" + i;
                        var brand = "Brand" + i;
                        var costprice = "CostPrice" + i;
                        var sellingprice = "SellingPrice" + i;
                        var mrp = "MRP" + i;
                        var serialno = "serialno" + i;
                        var supplier = "supplier" + i;
                        var itemtype = "ItemType" + i;

                        //document.getElementById("DDLSubCat").disabled = false;
                        document.getElementById("item").disabled = false;
                        if (document.getElementById(costprice) != null) {
                            //document.getElementById(typeOfMaterial).disabled = false;
                            document.getElementById(colorCode).disabled = false;
                            //document.getElementById(designCode).disabled = false;
                            document.getElementById(description).disabled = false;
                            document.getElementById(size).disabled = false;
                            document.getElementById(unit).disabled = false;
                            document.getElementById(costprice).disabled = false;
                            //document.getElementById(sellingprice).disabled = false;
                            //document.getElementById(mrp).disabled = false;
                            document.getElementById(brand).disabled = false;
                            document.getElementById(serialno).disabled = false;
                            //document.getElementById(supplier).disabled = false;
                            //document.getElementById(itemtype).disabled = false;
                        }
                    }
                    $("#Submit").trigger('click');
                }
            }
                // IF LAST ITEM IS DELETED THEN WITHOUT VALIDATION SUBMIT THE DATA..
            else {

                for (var i = 1; i <= rowId; i++) {
                    var typeOfMaterial = "materialType" + i;
                    var colorCode = "colorCodeData" + i;
                    var designCode = "designCodeData" + i;
                    var description = "itemDescription" + i;
                    var size = "Size" + i;
                    var unit = "Unit" + i;
                    var brand = "Brand" + i;
                    var costprice = "CostPrice" + i;
                    var sellingprice = "SellingPrice" + i;
                    var mrp = "MRP" + i;
                    var serialno = "serialno" + i;
                    var supplier = "supplier" + i;
                    var itemtype = "ItemType" + i;

                    document.getElementById("DDLSubCat").disabled = false;
                    document.getElementById("item").disabled = false;

                    if (document.getElementById(costprice) != null) {
                        //document.getElementById(typeOfMaterial).disabled = false;
                        document.getElementById(colorCode).disabled = false;
                        //document.getElementById(designCode).disabled = false;
                        document.getElementById(description).disabled = false;
                        document.getElementById(size).disabled = false;
                        document.getElementById(unit).disabled = false;
                        document.getElementById(costprice).disabled = false;
                        //document.getElementById(sellingprice).disabled = false;
                        //document.getElementById(mrp).disabled = false;
                        document.getElementById(brand).disabled = false;
                        document.getElementById(serialno).disabled = false;
                        //document.getElementById(supplier).disabled = false;
                        //document.getElementById(itemtype).disabled = false;
                    }
                }
                $("#Submit").trigger('click');
            }
        });
    });
</script>


@*DISPLAY DETAILS ON ITEM CHANGE EVENT*@
<script type="text/javascript">

    $(document).ready(function () {
        $("#category").autocomplete({
            source: "/Item/GetCategory",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#category").val(ui.item.value);
                    document.getElementById("category").value = ui.item.value;
                    $("#subcategory").attr("disabled", false);
                    document.getElementById("subcat").value = $("#category").val();
                    $("#category").blur();
                }
            }
        });

        $("#ItemType").change(function () {
            $("#supplier").attr("disabled", false);
        });

        $("#subcategory").autocomplete({
            minLength: 1,
            source: function (req, res) {
                var cat = $("#category").val();
                $.getJSON('/Item/GetSubCategories', { term: req.term, category: cat }, function (data) {
                    res(data);
                });
            },
            select: function (event, ui) {
                if (ui.item) {
                    $("#subcategory").val(ui.item.value);
                    $.getJSON("/Item/GetSubCatTax", { SubCategory: $("#subcategory").val() }, function (data) {
                        document.getElementById("SubCatTax").value = data.Percentage;
                    });
                    $("#subcategory").blur();
                    $("#ItemType").attr("disabled", false);
                    $("#supplier").attr("disabled", false);
                }
            }
        });

        $("#supplier").autocomplete({
            source: "/Supplier/GetSupplierNames",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#supplier").val(ui.item.value);
                    $("#supplier").blur();

                    document.getElementById("Save").style.display = "inline";
                    var rowId = 1;
                    $("#sortable1").empty();
                    var unorderedList = $("#sortable1");
                    var row = "row" + rowId;
                    var select = "TypeOfMaterial" + rowId;
                    var selectunit = "UnitList" + rowId;
                    var selectbrand = "BrandList" + rowId;
                    var colorCodeSelect = "ColorCode" + rowId;
                    var designname = "designName" + rowId;
                    var unitnumbertype = "NumberType" + rowId;
                    var typeOfMaterial = document.createElement("INPUT");
                    typeOfMaterial.setAttribute("type", "text");
                    typeOfMaterial.setAttribute("Placeholder", "TypeOfMaterial");
                    var colorCode = document.createElement("INPUT");
                    colorCode.setAttribute("type", "text");
                    colorCode.setAttribute("Placeholder", "ColorCode");
                    var unit = document.createElement("INPUT");
                    unit.setAttribute("type", "text");
                    unit.setAttribute("Placeholder", "Unit");
                    //var brand = document.createElement("SELECT");
                    var brand = document.createElement("INPUT");
                    brand.setAttribute("type", "text");
                    brand.setAttribute("Placeholder", "Brand");

                    var designCode = "designCodeData" + rowId;
                    var idModel1 = $(this).val();

                    unorderedList.append(
                    "<div class='panel' id='" + row + "'> " +
                    "<div class='form-group'></div><div class='row'><div class='col-md-12 col-lg-12'>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Item Name</label><input type='text' id='itemname" + rowId + "' placeholder='Item Name' name='itemname" + rowId + "' class='form-control' /></div>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Description</label><textarea rows='1' placeholder='Item Description' class='form-control' name='itemDescription" + rowId + "' id='itemDescription" + rowId + "' autocomplete='off'/></div>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Serial No</label><input type='text' id='serialno" + rowId + "' placeholder='Serial No' name='serialno" + rowId + "' class='form-control' /></div>" +
                    "<div class='form-group col-md-1 col-lg-1' id='" + colorCodeSelect + "' style='width:12.5%'><label>Color Code</label><input type='text' id='colorCodeData" + rowId + "' placeholder='Color' name='colorCodeData" + rowId + "' class='form-control' /></div>" +
                    "<div class='form-group col-md-1 col-lg-1'style='width:12.5%'><label>Unit</label><input type='text' id='Unit" + rowId + "' placeholder='Unit' name='Unit" + rowId + "' class='form-control' /><input type='hidden' id='" + unitnumbertype + "' name='" + unitnumbertype + "'/></div>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Size</label><input type='text' placeholder='Size' class='form-control' name='Size" + rowId + "' id='Size" + rowId + "' onkeypress='return DontAllowWhiteSpace(event)' autocomplete='off'/></div>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Brand</label><input type='text' id='Brand" + rowId + "' placeholder='Brand' name='Brand" + rowId + "' class='form-control' /></div>" +
                    "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Cost Price</label><input type='text' placeholder='Cost Price' class='form-control' name='CostPrice" + rowId + "' id='CostPrice" + rowId + "' onkeypress='return AllowNumbers(event)' autocomplete='off'/></div>" +
                    "</div></div>" +
                    "</div>"
                    );

                    $("#hdnRowCount").val(rowId);

                    //$("#supplier" + rowId).autocomplete({
                    //    source: "/Supplier/GetSupplierNames",
                    //    minLength: 1,
                    //    select: function (event, ui) {
                    //        if (ui.item) {
                    //            $("#supplier" + rowId).val(ui.item.value);
                    //            $("#supplier" + rowId).blur();
                    //        }
                    //    }
                    //})

                    $("#itemname" + rowId).autocomplete({
                        source: "/Item/GetItemNameList",
                        minLength: 1,
                        select: function (event, ui) {
                            if (ui.item) {
                                $("#itemname" + rowId).val(ui.item.value);
                                $("#itemname" + rowId).blur();
                            }
                        }
                    })

                    //$("#" + designCode).autocomplete({
                    //    source: "/Item/LoadDesignList",
                    //    minLength: 1,
                    //    select: function (event, ui) {
                    //        if (ui.item) {
                    //            $("#" + designCode).val(ui.item.value);
                    //            $.getJSON('/Design/GetDesignCodeByName', { Name: $("#" + designCode).val() }, function (data) {
                    //                $("#" + designname).val(data.DesignCode);
                    //            });
                    //            $("#" + designCode).blur();
                    //        }
                    //    }
                    //})

                    $("#Brand" + rowId).autocomplete({
                        source: "/Brand/GetBrand",
                        minLength: 1,
                        select: function (event, ui) {
                            if (ui.item) {
                                $("#Brand" + rowId).val(ui.item.value);
                                $("#Brand" + rowId).blur();
                            }
                        }
                    })

                    $("#Unit" + rowId).autocomplete({
                        source: "/Unit/GetUnitList",
                        minLength: 1,
                        select: function (event, ui) {
                            if (ui.item) {
                                $("#Unit" + rowId).val(ui.item.value);
                                $.getJSON('/Unit/GetDetailsByUnitName', { Name: $("#Unit" + rowId).val() }, function (data) {
                                    $("#NumberType" + rowId).val(data.NumberType);
                                });
                                $("#Unit" + rowId).blur();
                            }
                        }
                    })

                    //$("#materialType" + rowId).autocomplete({
                    //    source: "/TypeOfMaterial/GetMaterialList",
                    //    minLength: 1,
                    //    select: function (event, ui) {
                    //        if (ui.item) {
                    //            $("#materialType" + rowId).val(ui.item.value);
                    //            $("#materialType" + rowId).blur();
                    //        }
                    //    }
                    //})

                    $("#colorCodeData" + rowId).autocomplete({
                        source: "/TypeOfMaterial/GetColorList",
                        minLength: 1,
                        select: function (event, ui) {
                            if (ui.item) {
                                $("#colorCodeData" + rowId).val(ui.item.value);
                                $("#colorCodeData" + rowId).blur();
                            }
                        },
                        change: function (event, wi) {
                            var txt = document.getElementById("colorCodeData" + rowId).value;
                            txt = txt.replace(/\w\S*/g, function (txt) {
                                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                            });
                            document.getElementById("colorCodeData" + rowId).value = txt;
                        }
                    })
                }
            }
        });
    });
</script>

@*DYNAMIC ROW CREATION ON ENTER BUTTON*@
<script type="text/javascript">
    $(document).keypress(function (e) {
        if (e.which == 13) {

            if ($("#subcategory").val() != "" && $("#item").val() != "") {

                var rowId = document.getElementById("hdnRowCount").value;

                //CHECK ALL DATA IS FILL OR NOT
                var row = "row" + rowId;
                var typeOfMaterial = "materialType" + rowId;
                var colorCode = "colorCodeData" + rowId;
                var designCode = "designCodeData" + rowId;
                var designname = "designName" + rowId;
                var description = "itemDescription" + rowId;
                var size = "Size" + rowId;
                var unit = "Unit" + rowId;
                var brand = "Brand" + rowId;
                var costprice = "CostPrice" + rowId;
                var sellingprice = "SellingPrice" + rowId;
                var mrp = "MRP" + rowId;
                var subcategory = "subcategory" + rowId;
                var itemname = "itemname" + rowId;
                var itemtype = "ItemType" + rowId;
                var serialno = "serialno" + rowId;
                var supplier = "supplier" + rowId;

                if (document.getElementById(costprice) != null) {

                    var type = document.getElementById("ItemType").value;

                    //If previous row is inventory then check all the validations
                    if (type == "Inventory" || type == "Select") {

                        //if ($("#" + subcategory).val() == "") {
                        //    alertbox("Please Enter The SubCategory");
                        //    return false;
                        //}
                        if ($("#" + itemname).val() == "") {
                            alertbox("Please Enter The Item Name");
                            return false;
                        }
                            //else if ($("#" + itemtype).val() == "Select") {
                            //    alertbox("Please Select The Item Type");
                            //    return false;
                            //}
                        else if ($("#" + size).val() == "") {
                            alertbox("Please Enter The Size");
                            return false;
                        }
                            //else if ($("#" + typeOfMaterial).val() == "") {
                            //    alertbox("Please Select The Type Of Material");
                            //    return false;
                            //}
                            //else if ($("#" + designCode).val() == "") {
                            //    alertbox("Please Enter The Design Code");
                            //    return false;
                            //}
                        else if ($("#" + brand).val() == "") {
                            alertbox("Please Enter The Brand Name");
                            return false;
                        }
                            //else if ($("#" + supplier).val() == "") {
                            //    alertbox("Please Enter The Supplier Name");
                            //    return false;
                            //}
                        else {
                            //CHECK IF SAME ITEM IS ALREADY CREATED THEN GET ALERT 
                            var counter = 0;
                            for (i = 1; i < rowId; i++) {
                                var MATERIAL = "materialType" + i;
                                var COLOR = "colorCodeData" + i;
                                var COSTPRICE = "CostPrice" + i;
                                var BRAND = "Brand" + i;
                                var SIZE = "Size" + i;
                                var DESIGN = "designCodeData" + i;
                                var UNIT = "Unit" + i;

                                //var material = document.getElementById("materialType" + rowId).value;
                                var color = document.getElementById("colorCodeData" + rowId).value;
                                var costprice = document.getElementById("CostPrice" + rowId).value;
                                var brand = document.getElementById("Brand" + rowId).value;
                                var size = document.getElementById("Size" + rowId).value;
                                //var design = document.getElementById("designCodeData" + rowId).value;
                                var unit = document.getElementById("Unit" + rowId).value;
                                var serialno = document.getElementById("serialno" + rowId).value;

                                //IF ROW IS DELETED THEN CURRENT ITEM WON'T GET COMPARED
                                if ($("#" + COLOR).val() == color && $("#" + COSTPRICE).val() == costprice && $("#" + BRAND).val() == brand && $("#" + SIZE).val() == size && $("#" + UNIT).val() == unit) {
                                    alertbox("The Item Is Already Created..");
                                    counter = i;
                                    break;
                                }
                            }

                            if (counter == 0) {

                                //var material = document.getElementById("materialType" + rowId).value;
                                var color = document.getElementById("colorCodeData" + rowId).value;
                                var costprice = document.getElementById("CostPrice" + rowId).value;
                                var brand = document.getElementById("Brand" + rowId).value;
                                var size = document.getElementById("Size" + rowId).value;
                                //var design = document.getElementById("designCodeData" + rowId).value;
                                var unit = document.getElementById("Unit" + rowId).value;
                                var SUBCAT = document.getElementById("subcategory").value;

                                //CHECK ITEM IS ALREADY CREATED IN THE DATABASE
                                $.getJSON("/Item/GetAllItemDetails", { Material: null, Color: color, Costprice: costprice, Brand: brand, Size: size, Design: null, Unit: unit, SubCat: SUBCAT },
                               function (stateData) {
                                   if (stateData == "Present") {
                                       alertbox("The Item Is Already Created..")
                                   }
                                   else {
                                       //DISABLED THE PREVIOUS ROW
                                       var row = "row" + rowId;
                                       var typeOfMaterial = "materialType" + rowId;
                                       var colorCode = "colorCodeData" + rowId;
                                       var designCode = "designCodeData" + rowId;
                                       var designname = "designName" + rowId;
                                       var description = "itemDescription" + rowId;
                                       var size = "Size" + rowId;
                                       var unit = "Unit" + rowId;
                                       var costprice = "CostPrice" + rowId;
                                       var sellingprice = "SellingPrice" + rowId;
                                       var mrp = "MRP" + rowId;
                                       var brand = "Brand" + rowId;
                                       var serialno = "serialno" + rowId;
                                       var itemname = "itemname" + rowId;
                                       var itemtype = "ItemType" + rowId;
                                       var subcategory = "subcategory" + rowId;
                                       var supplier = "supplier" + rowId;
                                       GenerateDynamicRows(rowId);
                                   }
                               });
                            }
                        }
                    }
                    else {

                        if ($("#" + unit).val() == "") {
                            alertbox("Please Select The Unit For Non Inventory Type");
                        }
                        else {
                            //CHECK IF SAME ITEM IS ALREADY CREATED THEN GET ALERT 
                            var counter = 0;
                            for (i = 1; i < rowId; i++) {
                                var MATERIAL = "materialType" + i;
                                var COLOR = "colorCodeData" + i;
                                var COSTPRICE = "CostPrice" + i;
                                var BRAND = "Brand" + i;
                                var SIZE = "Size" + i;
                                var DESIGN = "designCodeData" + i;
                                var UNIT = "Unit" + i;
                                var SERIALNO = "serialno" + i;

                                var color = document.getElementById("colorCodeData" + rowId).value;
                                var costprice = document.getElementById("CostPrice" + rowId).value;
                                var brand = document.getElementById("Brand" + rowId).value;
                                var size = document.getElementById("Size" + rowId).value;
                                var unit = document.getElementById("Unit" + rowId).value;
                                var serialno = document.getElementById("serialno" + rowId).value;

                                //IF ROW IS DELETED THEN CURRENT ITEM WON'T GET COMPARED
                                if ($("#" + MATERIAL).val() == null && $("#" + COLOR).val() == color && $("#" + COSTPRICE).val() == costprice && $("#" + BRAND).val() == brand && $("#" + SIZE).val() == size && $("#" + DESIGN).val() == null && $("#" + UNIT).val() == unit && $("#" + SERIALNO).val() == serialno) {
                                    alertbox("The Item Is Already Created..");
                                    counter = i;
                                    break;
                                }
                            }

                            if (counter == 0) {

                                var color = document.getElementById("colorCodeData" + rowId).value;
                                var costprice = document.getElementById("CostPrice" + rowId).value;
                                var brand = document.getElementById("Brand" + rowId).value;
                                var size = document.getElementById("Size" + rowId).value;
                                var unit = document.getElementById("Unit" + rowId).value;
                                var SUBCAT = document.getElementById("subcategory").value;

                                //CHECK ITEM IS ALREADY CREATED IN THE DATABASE
                                $.getJSON("/Item/GetAllItemDetails", { Material: null, Color: color, Costprice: costprice, Brand: brand, Size: size, Design: null, Unit: unit, SubCat: SUBCAT },
                               function (stateData) {
                                   if (stateData == "Present") {
                                       alertbox("The Item Is Already Created..")
                                   }
                                   else {
                                       //DISABLED THE PREVIOUS ROW
                                       var row = "row" + rowId;
                                       var colorCode = "colorCodeData" + rowId;
                                       var description = "itemDescription" + rowId;
                                       var size = "Size" + rowId;
                                       var unit = "Unit" + rowId;
                                       var costprice = "CostPrice" + rowId;
                                       var sellingprice = "SellingPrice" + rowId;
                                       var mrp = "MRP" + rowId;
                                       var brand = "Brand" + rowId;
                                       var serialno = "serialno" + rowId;
                                       var supplier = "supplier" + rowId;
                                       var itemtype = "ItemType" + rowId;

                                       GenerateDynamicRows(rowId);
                                   }
                               });
                            }
                        }
                    }
                }
                else {
                    GenerateDynamicRows(rowId);
                }
            }
            else {
                alertbox("Please Fill Item Name..");
            }
        }
    });
</script>

<script type="text/javascript">
    function GenerateDynamicRows(rowId) {
        rowId = +rowId + 1;
        var unorderedList = $("#sortable1");
        var row = "row" + rowId;
        var select = "TypeOfMaterial" + rowId;
        var colorCodeSelect = "ColorCode" + rowId;
        var designname = "designName" + rowId;
        var selectunit = "UnitList" + rowId;
        var selectbrand = "BrandList" + rowId;
        var unit = document.createElement("INPUT");
        unit.setAttribute("type", "text");
        unit.setAttribute("placeholder", "Unit");
        var brand = document.createElement("INPUT");
        brand.setAttribute("type", "text");
        brand.setAttribute("placeholder", "Brand");
        var unitnumbertype = "NumberType" + rowId;
        var typeOfMaterial = document.createElement("INPUT");
        typeOfMaterial.setAttribute("type", "text");
        typeOfMaterial.setAttribute("placeholder", "Type Of Material");
        var colorCode = document.createElement("INPUT");
        colorCode.setAttribute("type", "text");
        colorCode.setAttribute("placeholder", "ColorCode");

        var designCode = "designCodeData" + rowId;

        unorderedList.append(
        "<div class='panel' id='" + row + "'> " +
        "<div class='form-group'></div><div class='row'><div class='col-md-12 col-lg-12'>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Item Name</label><input type='text' id='itemname" + rowId + "' placeholder='Item Name' name='itemname" + rowId + "' class='form-control' value='" + $("#itemname" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Description</label><textarea rows='1' placeholder='Item Description' class='form-control' name='itemDescription" + rowId + "' id='itemDescription" + rowId + "' autocomplete='off' value='" + $("#itemDescription" + (rowId - 1)).val() + "'/></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Serial No</label><input type='text' id='serialno" + rowId + "' placeholder='Serial No' name='serialno" + rowId + "' class='form-control' value='" + $("#serialno" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' id='" + colorCodeSelect + "' style='width:12.5%'><label>Color Code</label><input type='text' id='colorCodeData" + rowId + "' placeholder='Color' name='colorCodeData" + rowId + "' class='form-control' value='" + $("#colorCodeData" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Unit</label><input type='text' id='Unit" + rowId + "' placeholder='Unit' name='Unit" + rowId + "' class='form-control' value='" + $("#Unit" + (rowId - 1)).val() + "' /><input type='hidden' id='" + unitnumbertype + "' name='" + unitnumbertype + "' value='" + $("#NumberType" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Size</label><input type='text' placeholder='Size' class='form-control' name='Size" + rowId + "' id='Size" + rowId + "' onkeypress='return DontAllowWhiteSpace(event)' autocomplete='off' value='" + $("#Size" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Brand</label><input type='text' id='Brand" + rowId + "' placeholder='Brand' name='Brand" + rowId + "' class='form-control' value='" + $("#Brand" + (rowId - 1)).val() + "' /></div>" +
        "<div class='form-group col-md-1 col-lg-1' style='width:12.5%'><label>Cost Price</label><input type='text' placeholder='Cost Price' class='form-control' name='CostPrice" + rowId + "' id='CostPrice" + rowId + "' onkeypress='return AllowNumbers(event)' autocomplete='off' value='" + $("#CostPrice" + (rowId - 1)).val() + "' /></div>" +
        "</div></div>" +

        "<div class='col-md-12 col-lg-12'>" +
        "<a href='#' onclick='DeleteRow(" + rowId + ")' class='fa fa-trash fa-lg' style='color:red; float:right'></a>" +
        "</div></div></div>"
        );

        $("#hdnRowCount").val(rowId);

        $("#itemname" + rowId).autocomplete({
            source: "/Item/GetItemNameList",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#itemname" + rowId).val(ui.item.value);
                    $("#itemname" + rowId).blur();
                }
            }
        })

        $("#supplier" + rowId).autocomplete({
            source: "/Supplier/GetSupplierNames",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#supplier" + rowId).val(ui.item.value);
                    $("#supplier" + rowId).blur();
                }
            }
        })

        $("#Brand" + rowId).autocomplete({
            source: "/Brand/GetBrand",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#Brand" + rowId).val(ui.item.value);
                }
            }
        })

        $("#Unit" + rowId).autocomplete({
            source: "/Unit/GetUnitList",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#Unit" + rowId).val(ui.item.value);
                    $.getJSON('/Unit/GetDetailsByUnitName', { Name: $("#Unit" + rowId).val() }, function (data) {
                        $("#NumberType" + rowId).val(data.NumberType);
                    });
                }
            }
        })

        //$("#materialType" + rowId).autocomplete({
        //    source: "/TypeOfMaterial/GetMaterialList",
        //    minLength: 1,
        //    select: function (event, ui) {
        //        if (ui.item) {
        //            $("#materialType" + rowId).val(ui.item.value);
        //        }
        //    }
        //})

        $("#colorCodeData" + rowId).autocomplete({
            source: "/TypeOfMaterial/GetColorList",
            minLength: 1,
            select: function (event, ui) {
                if (ui.item) {
                    $("#colorCodeData" + rowId).val(ui.item.value);
                }
            }
        })

        document.getElementById("Save").style.display = "inline";
    }
</script>

@*CALCULATE SELLINGPRICE USING MRP*@
<script type="text/javascript">
    function CalcSellingPrice(id) {
        var costprice = "CostPrice" + id;
        var sellingprice = "SellingPrice" + id;
        var mrp = "MRP" + id;

        var tax = document.getElementById("SubCatTax").value;
        var costpriceval = +document.getElementById(costprice).value;
        var mrpval = +document.getElementById(mrp).value;
        if (mrpval < costpriceval) {
            alertbox("MRP Cannot Be Less Than Cost Price");
            document.getElementById(sellingprice).value = 0;
            document.getElementById(mrp).value = 0;
            return false;
        }
        var costprisetax = costpriceval * tax / 100;
        var costprisetaxinper = costpriceval / (costpriceval + costprisetax) * tax;
        var sellingpriceval = mrpval - (mrpval * costprisetaxinper / 100);
        if (sellingpriceval < costpriceval) {
            alertbox("Selling Price Cannot Be Less Than Cost Price");
            document.getElementById(sellingprice).value = 0;
            document.getElementById(mrp).value = 0;
        }
        else {
            document.getElementById(sellingprice).value = sellingpriceval.toFixed(2);
        }
    }
</script>

@*CALCULATE MRP USING SELLINGPRICE*@
<script type="text/javascript">
    function CalcMRP(id) {
        var costprice = "CostPrice" + id;
        var sellingprice = "SellingPrice" + id;
        var mrp = "MRP" + id;

        var tax = document.getElementById("SubCatTax").value;
        var costpriceval = +document.getElementById(costprice).value;
        var sellingpriceval = +document.getElementById(sellingprice).value;
        if (sellingpriceval < costpriceval) {
            alertbox("SellingPrice Cannot Be Less Than Cost Price");
            document.getElementById(sellingprice).value = 0;
            document.getElementById(mrp).value = 0;
        }
        else {
            var taxonsellprice = sellingpriceval * tax / 100;
            var mrpval = sellingpriceval + taxonsellprice;
            document.getElementById(mrp).value = mrpval.toFixed(2);
        }
    }
</script>


<script type="text/javascript">
    $(document).ready(function () {
        $("#DDLSubCat").change(function () {
            document.getElementById("item").disabled = false;
            var subcat = document.getElementById("DDLSubCat").value;
            $.getJSON("/Item/GetSubCatTax", { SubCategory: subcat },
                    function (data) {
                        document.getElementById("SubCatTax").value = data.Percentage;
                    });



            $("#DDLSubCat").change(function () {
                if (document.getElementById("DDLSubCat").value == "") {
                    var select = $("#item");
                    select.empty();
                    select.append($('<option/>', {
                        value: "",
                        text: "Select Item"
                    }));
                    document.getElementById("sortable1").innerHTML = "";
                    document.getElementById("Save").style.display = "none";
                }
            });

        });
    });
</script>


<script type="text/javascript">
    function GetUnitDecimalType(rowid) {
        $.getJSON("/Item/GetUnitType", { unit: $("#Unit" + rowid).val() },
            function (data) {
                $("#NumberType" + rowid).val(data);
            });
    }
</script>

<script type="text/javascript">
    $(document).ready(function () {

        $("#bookno").change(function () {
            var bookno = $(this).val();
            $("#category").attr("disabled", false);
        });

        var rowId = document.getElementById("hdnRowCount").value;
        var costprice = "CostPrice" + rowId;
        var sellingprice = "SellingPrice" + rowId;
        var mrp = "MRP" + rowId;
        $("#" + costprice).keyup(function () {
            if (this.value.match(/[^0-9]/g)) {
                this.value = this.value.replace(/[^0-9]/g, '');
            }
        });

    });

    function AllowNumbers(key) {
        var keycode = (key.which) ? key.which : key.keyCode;
        //comparing pressed keycodes
        if (!(keycode == 8 || keycode == 46) && (keycode < 48 || keycode > 57)) {
            return false;
        }
    }

    function DontAllowWhiteSpace(key) {
        var keycode = (key.which) ? key.which : key.keyCode;
        //comparing pressed keycodes
        if (keycode == 8 || keycode == 32) {
            return false;
        }
    }

    function Link() {
        window.location.assign("/Item/CreateItemName");
    }
</script>

<!-- Start: Header -->
@Html.Partial("../Shared/Header")
<!-- End: Header -->
<!-- Start: Main -->
<section>
    <div class="mainwrapper">
        <div class="col-md-12 col-lg-12">
            <!-- Start: Sidebar -->
            @Html.Partial("../Shared/LeftMenu")
            <!-- End: Sidebar -->
            <!-- Start: Content -->
            @using (Html.BeginForm("Create", "Catalogue", FormMethod.Post))
            {
                @Html.ValidationSummary(true)
                <input type="hidden" id="hdnRowCount" name="hdnRowCount" />
                <input type="hidden" id="SubCatTax" name="SubCatTax" />
                <input type="hidden" name="subcat" id="subcat" />
                <audio id="audio" muted="true" preload="auto" style="display: none" controls="controls" autoplay="false">
                    <source src="" type="audio/ogg" />
                </audio>
                <div class="mainpanel">
                    <div class="col-md-12 col-lg-12">

                        <br />
                        <h2>Create Item</h2>
                        <div class="table table-bordered">
                            <div class="row">
                                <div class="col-md-12 col-lg-12">
                                    <div style="height: 10px"></div>
                                    <div class="col-md-12 col-lg-12">
                                        <div class="row">
                                            <div class="form-group col-md-2 col-lg-2">
                                                <label for="exampleInputDistrict">Book Number<i style="color: red">*</i></label>
                                                @Html.TextBoxFor(model => model.CatalogueDetails.BookNumber, new { @class = "form-control", id = "bookno", @placeholder = "Book No" })
                                                @Html.ValidationMessageFor(model => model.CatalogueDetails.BookNumber)
                                            </div>
                                            <div class="form-group col-md-2 col-lg-2">
                                                <label for="exampleInputDistrict">Item Category<i style="color: red">*</i></label>
                                                @Html.TextBoxFor(model => model.CatalogueDetails.Category, new { @class = "form-control", @id = "category", @placeholder = "Category" })
                                                @Html.ValidationMessageFor(model => model.CatalogueDetails.Category)
                                            </div>

                                            <div class="col-lg-2 col-md-2">
                                                <label>Sub Category</label>
                                                @Html.TextBoxFor(model => model.CatalogueDetails.Subcategory, new { @class = "form-control", @id = "subcategory", @placeholder = "Sub Category", @disabled = "disabled" })
                                            </div>

                                            <div class="col-lg-2 col-md-2">
                                                <label>Item Type</label>
                                                <select class='form-control' id='ItemType' name='ItemType' disabled="disabled">
                                                    <option>Select</option>
                                                    <option selected>Inventory</option>
                                                    <option>Non Inventory</option>
                                                </select>
                                            </div>

                                            <div class="col-lg-2 col-md-2">
                                                <label>Supplier</label>
                                                <input type="text" class="form-control" name="supplier" id="supplier" placeholder="Supplier" disabled="disabled" />
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="sortable1"></div>
                       
                        <div class="col-md-offset-5 col-lg-offset-5">
                            <button type="button" class="btn btn-success" id="Save" style="display: none;">Save</button>
                            <button type="submit" class="btn btn-success" id="Submit" style="display: none;">Submit</button>
                        </div>
                        
                    </div>
                </div>
            }
        </div>
    </div>
</section>
